<!-- Zaid Fareed 
23i-0829
Section C
Task 2 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archery Physics - Sticky Arrow</title>
    <style>
        body {
            background-color: rgb(27, 27, 27);
            background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('../ArcheryGame/img/background.avif');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            font-family: sans-serif;
        }
        .Shadowbox {
            width: 1000px;
            height: 500px;
            background-color: transparent;
            position: relative;
            overflow: hidden;
            perspective: 600px;
        }
        .topBar {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .scoreBoard,
        .timerBoard {
            font-size: 32px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px #000;
        }
        .timerBoard {
            min-width: 150px;
            text-align: center;
        }
        .modeBtn {
            padding: 10px 20px;
            font-size: 18px;
            font-weight: bold;
            background-color: #e67e22;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px #d35400;
            transition: transform 0.1s;
        }
        .modeBtn:active {
            transform: translateY(4px);
            box-shadow: 0 0 #d35400;
        }
        .target {
            position: absolute;
            top: 50%;
            right: 100px;
            width: 20px;
            height: 120px;
            transform: translateY(-50%);
            border-radius: 6px;
            border: 2px solid #5d4037;
            background: linear-gradient(to bottom,
                    #8d6e63 0%, #8d6e63 10%,
                    #ffffff 10%, #ffffff 30%,
                    #d32f2f 30%, #d32f2f 45%,
                    #ffeb3b 45%, #ffeb3b 55%,
                    #d32f2f 55%, #d32f2f 70%,
                    #ffffff 70%, #ffffff 90%,
                    #8d6e63 90%, #8d6e63 100%);
            box-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        .bow {
            position: absolute;
            top: 200px;
            left: 150px;
            width: 40px;
            height: 120px;
            transform-origin: center;
            cursor: pointer;
            z-index: 2;
        }
        .woodenpart {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            border-right: 10px solid #8B4513;
            border-top: 10px solid #8B4513;
            border-bottom: 10px solid #8B4513;
            border-left: none;
            border-radius: 0 60px 60px 0;
            position: relative;
            z-index: 2;
        }
        .string-container {
            position: absolute;
            top: 0;
            left: -200px;
            width: 200px;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        .bow-string {
            fill: none;
            stroke: white;
            stroke-width: 2;
            stroke-linecap: round;
        }
        .arrow {
            position: absolute;
            top: 50%;
            left: 0px;
            width: 80px;
            height: 4px;
            background-color: burlywood;
            transform: translateY(-50%);
            z-index: 1;
            pointer-events: none;
        }
        .arrow::after {
            content: '';
            position: absolute;
            right: -10px;
            top: -4px;
            border-left: 10px solid silver;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        .arrow.hit {
            background-color: limegreen;
        }
        .arrow.hit::after {
            border-left-color: limegreen;
        }
    </style>
</head>
<body>
    <div class="topBar">
        <div class="scoreBoard">Score: <span id="scoreVal">0</span></div>
        <div class="timerBoard">Time: <span id="curTime">∞</span></div>
        <button class="modeBtn">Mode: <span id="currentMode">Easy</span></button>
    </div>
    <div class="Shadowbox">
        <div class="target"></div>
        <div class="bow">
            <div class="woodenpart"></div>
            <div class="arrow"></div>
            <div class="string-container">
                <svg width="100%" height="100%">
                    <polyline class="bow-string" points="200,0 200,60 200,120" />
                </svg>
            </div>
        </div>
    </div>
    <script>
        const box = document.querySelector('.Shadowbox');
        const bow = document.querySelector('.bow');
        const arrow = document.querySelector('.arrow');
        const string = document.querySelector('.bow-string');
        const target = document.querySelector('.target');
        const scoreDisplay = document.getElementById('scoreVal');
        const modeBtn = document.querySelector('.modeBtn');
        const modeSpan = document.getElementById('currentMode');
        const timeSpan = document.getElementById('curTime');
        //Values Declaration (Debug)
        let aiming = false;
        let pull = 0;
        const limit = 130;
        let score = 0;
        let posX = 0, posY = 0;
        let sX = 0, sY = 0;
        let grav = 0.25, angle = 0;
        let gameMode = 'Easy';
        let timeLeft = 60;
        let flightInterval = null, targetMoveInterval = null, timerInterval = null;
        let tY = 190,tDir = 1,tSpeed = 3;
        modeBtn.addEventListener('click', () => {
            if (gameMode === 'Easy') {
                gameMode = 'Medium';
                modeSpan.textContent = 'Medium';
                startMediumMode();
            } else if (gameMode === 'Medium') {
                gameMode = 'Hard';
                modeSpan.textContent = 'Hard';
                startHardMode();
            } else if (gameMode === 'Hard') {
                gameMode = 'Easy';
                modeSpan.textContent = 'Easy';
                startEasyMode();
            }
        });
        function resetTargetPosition() {
            clearInterval(targetMoveInterval);
            target.style.top = '50%';
            target.style.transform = 'translateY(-50%)';
        }
        function startEasyMode() {
            resetTargetPosition();
            clearInterval(timerInterval);
            timeSpan.textContent = '∞';
            score = 0;
            scoreDisplay.textContent = score;
            reset();
        }
        function startMediumMode() {
            resetTargetPosition();
            initTimerMode();
        }
        function startHardMode() {
            initTimerMode();
            tY = 190;
            tDir = 1;
            clearInterval(targetMoveInterval);
            targetMoveInterval = setInterval(moveTarget, 16);
        }
        function initTimerMode() {
            score = 0;
            scoreDisplay.textContent = score;
            reset();
            timeLeft = 60;
            timeSpan.textContent = timeLeft;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timeSpan.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("Time's Up! Final Score: " + score);
                    if (gameMode === 'Hard') {
                        startHardMode();
                    } else {
                        startMediumMode();
                    }
                }
            }, 1000);
        }
        function moveTarget() {
            tY += tSpeed * tDir;
            if (tY > 380) {
                tY = 380;
                tDir = -1;
            } else if (tY < 0) {
                tY = 0;
                tDir = 1;
            }
            target.style.top = tY + 'px';
            target.style.transform = 'none';
        }
        bow.addEventListener('mousedown', () => {
            if (flightInterval) {
                return;
            }
            aiming = true;
            arrow.classList.remove('hit');
        });
        document.addEventListener('mousemove', (event) => {
            if (!aiming) {
                return;
            }
            const rect = bow.getBoundingClientRect();
            const midX = rect.left + (rect.width / 2);
            const midY = rect.top + (rect.height / 2);
            const x = event.clientX - midX;
            const y = event.clientY - midY;
            angle = Math.atan2(y, x) + Math.PI;
            const deg = angle * (180 / Math.PI);
            bow.style.transform = `rotate(${deg}deg)`;
            const dist = Math.sqrt(x * x + y * y);
            pull = Math.min(dist, limit);
            arrow.style.left = (-pull) + 'px';
            arrow.style.top = '50%';
            arrow.style.transform = 'translateY(-50%)';
            const lineX = 200 - pull;
            string.setAttribute('points', `200,0 ${lineX},60 200,120`);
        });
        document.addEventListener('mouseup', () => {
            if (!aiming) {
                return;
            }
            aiming = false;
            string.setAttribute('points', '200,0 200,60 200,120');
            const startRect = arrow.getBoundingClientRect();
            const boxRect = box.getBoundingClientRect();
            posX = startRect.left - boxRect.left;
            posY = startRect.top - boxRect.top;
            box.appendChild(arrow);
            arrow.style.left = posX + 'px';
            arrow.style.top = posY + 'px';
            const power = pull * 0.3;
            sX = Math.cos(angle) * power;
            sY = Math.sin(angle) * power;
            clearInterval(flightInterval);
            flightInterval = setInterval(move, 16);
        });
        function move() {
            sY += grav;
            posX += sX;
            posY += sY;
            const rot = Math.atan2(sY, sX) * (180 / Math.PI);
            arrow.style.left = posX + 'px';
            arrow.style.top = posY + 'px';
            arrow.style.transform = `rotate(${rot}deg)`;
            const box1 = arrow.getBoundingClientRect();
            const box2 = target.getBoundingClientRect();
            let hit;
            if (
                box1.right >= box2.left && box1.left <= box2.right && 
                box1.bottom >= box2.top && box1.top <= box2.bottom) 
            {
                hit = true;
            } else {
                hit = false;
            }
            if (hit) {
                const tCenterY = box2.top + box2.height / 2;
                const arrY = box1.top + box1.height / 2;
                const diffY = Math.abs(arrY - tCenterY);
                const halfHeight = box2.height / 2;
                const offset = diffY / halfHeight;
                let points = 0;
                if (offset <= 0.2) {
                    points = 10;
                } else if (offset <= 0.4) {
                    points = 8;
                } else if (offset <= 0.6) {
                    points = 6;
                } else if (offset <= 0.8) {
                    points = 4;
                } else {
                    points = 2;
                }
                stop(true, points);
            } else if (posX > 2000 || posY > 1000 || 
            posX < -500) {
                stop(false, 0);
            }
        }
        function stop(success, points) {
            clearInterval(flightInterval);
            flightInterval = null;
            if (success) {
                score += points;
                scoreDisplay.textContent = score;
                const arrowRect = arrow.getBoundingClientRect();
                const targetRect = target.getBoundingClientRect();
                const relativeLeft = arrowRect.left - targetRect.left;
                const relativeTop = arrowRect.top - targetRect.top;
                target.appendChild(arrow);
                arrow.style.left = relativeLeft + 'px';
                arrow.style.top = relativeTop + 'px';
                arrow.classList.add('hit');
                setTimeout(reset, 1000);
            } else {
                reset();
            }
        }
        function reset() {
            clearInterval(flightInterval);
            flightInterval = null;
            pull = 0;
            arrow.classList.remove('hit');
            bow.appendChild(arrow);
            arrow.style.left = '0px';
            arrow.style.top = '50%';
            arrow.style.transform = 'translateY(-50%)';
            bow.style.transform = 'rotate(0deg)';
        }
    </script>
</body>
</html>